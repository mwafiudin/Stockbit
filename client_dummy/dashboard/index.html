<!DOCTYPE html>
<html>

<head>
    <title>Dashboard</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Menggunakan Bootstrap CSS dari CDN -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

    <!-- Menggunakan Bootstrap JavaScript dari CDN (termasuk jQuery dan Popper.js) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</head>

<body>
    <!-- <h1>Dashboard</h1> -->
    <p>Hello, <span id="nameUser"></span></p>
    <!-- <div style="border: 1px solid black;">
        <div class="d-flex justify-content-start">
            <div>
                <p>BOT 1</p>
                <p>Trade Method : BSJP</p>
            </div>
            <div style="content: ''; width: 15px;"></div>
            <div>
                <p>Date : 01 Sep - 30 Sep</p>
                <p>21 Active Days</p>
            </div>
            <div style="content: ''; width: 15px;"></div>
            <div>
                <p>32,697.05</p>
                <p>+30,2%</p>
            </div>
        </div>
    </div> -->
    <button onclick="goToRunAutomation()">+ Run Automation</button>
    <div></div>
    <button type="button" id="logout-button">Logout</button>

    <div id="access-token-info">
        <!-- Tempat untuk menampilkan access token -->
    </div>

    <script>
        // Ambil access token dari local storage
        var accessToken = localStorage.getItem("access_token");

        // Periksa apakah access token ada
        if (accessToken) {
            // Tampilkan access token di elemen dengan ID "access-token-info"
            document.getElementById("access-token-info").textContent =
                "Access Token: " + accessToken;
        } else {
            // Jika access token tidak ditemukan
            document.getElementById("access-token-info").textContent =
                "Access Token tidak ditemukan.";
        }

        function goToRunAutomation() {
            window.location.href = "run_automation/index.html";
        }

        document
            .getElementById("logout-button")
            .addEventListener("click", function() {
                // Kirim permintaan AJAX ke /logout
                var xhr = new XMLHttpRequest();
                xhr.open("GET", "http://127.0.0.1:5000/logout", true);
                // Tambahkan header Authorization dengan token bearer
                xhr.setRequestHeader("Authorization", "Bearer " + accessToken);

                xhr.onload = function() {
                    if (xhr.status === 200) {
                        // Menghapus access_token dari penyimpanan lokal saat logout
                        localStorage.removeItem("access_token");
                        alert("Logout berhasil.");
                    } else {
                        // Logout gagal, tampilkan pesan kesalahan
                        alert("Logout gagal.");
                    }
                    window.location.href = "../index.html";
                };
                xhr.send();
            });

        $(document).ready(function() {
            $.ajax({
                type: "GET",
                url: "http://127.0.0.1:5000/data_dashboard",
                contentType: "application/json",
                headers: {
                    Authorization: "Bearer " + accessToken, // Gantilah access_token dengan nilai token yang Anda miliki
                },
                success: function(response) {
                    // Tampilkan respons dari server
                    console.log(JSON.stringify(response));
                    document.getElementById("nameUser").textContent = response.name_user;
                },
                error: function(error) {
                    // Menampilkan pesan kesalahan dalam bentuk alert
                    alert("Terjadi kesalahan: " + error.statusText);
                    window.location.href = "../index.html";
                    console.error("Error:", error);
                },
            });
        });
    </script>
</body>

</html>